---

---


# GraalVM 与 JVM：GraalVM 是 Java 应用程序的未来吗？

> 第一次知道GraalVM还是在周志明老师的《深入理解JVM》一书中，当时重点关注在HotSpot JVM上。因此对于GraalVM相关的内容只是当做拓展知识看。后来在网上也陆陆续续接触了一些GraalVM相关的碎片化知识。至今还未系统的学习一下。恰好最近又看到了一篇相关的文章。而且随着近来对性能和效率的要求不断提高，GraalVM 逐渐在 Java 中表现出来了生态中的潜力，尤其是在一些需要最大限度性能和快速启动的场景下。因此，在这里做一下简单的记录和介绍。

## 什么是GraalVM？

GraalVM是 Oracle 开发的高性能运行时，支持多种编程语言，包括 Java、JavaScript、Ruby、Python 和 R。它的一个突出功能是 Native Image 技术，该技术允许将 Java 应用程序提前 (AOT) 编译为本机机器代码。这消除了运行时对 JVM 的需求，从而缩短了启动时间并降低了内存开销。

### GraalVM的主要特点：GraalVM的主要特点

- 多语言编程： 在单一运行时上运行用多种语言编写的应用程序。
- 本机映像： 将 Java 应用程序编译为独立的本机可执行文件。
- 改进的性能： 针对吞吐量和启动时间进行了优化。
- 工具支持： 包括调试、分析和监控工具。

## 传统 JVM：久经考验

几十年来，JVM 一直是 Java 应用程序的支柱。它为运行 Java 字节码提供了一个强大且独立于平台的环境。JVM 的即时 (JIT) 编译器会在运行时动态优化代码，从而使长时间运行的应用程序非常高效。

### JVM 的主要特点

- 平台独立性：  “一次编写，随处运行”的能力。
- JIT 编译： 动态优化代码以提高性能。
- 成熟的生态系统： 广泛的库、框架和工具。
- 垃圾收集：  Java 应用程序的自动内存管理。

## GraalVM 原生镜像与 JVM：比较

### 启动时间

- GraalVM 原生镜像： 原生可执行文件的启动时间明显更快，因为它们绕过了 JVM 的初始化过程。这使得 GraalVM 成为无服务器函数或命令行工具等短期应用程序的理想选择。
- JVM： 由于初始化和 JIT 编译过程，JVM 的启动时间较慢。不过，对于 Web 服务器或企业系统等长期运行的应用程序来说，这不是什么大问题。

### 内存使用情况

- GraalVM Native Image： 原生可执行文件消耗的内存更少，因为它们不需要 JVM 的运行时开销。这对于资源受限的环境（如微服务或云原生应用程序）尤其有益。
- JVM：  JVM 由于其运行时环境而具有较高的内存开销，但它提供了垃圾收集和动态优化等高级功能。

### 性能

- GraalVM 原生镜像： 虽然原生可执行文件的启动时间更快，但它们的峰值性能可能并不总是与 JVM 相匹配，尤其是对于长时间运行的应用程序而言，其中 JIT 编译器可以随着时间的推移优化代码。
- JVM：  JVM 的 JIT 编译器擅长在运行时优化代码，使其对于具有持续工作负载的应用程序来说非常高效。


### 兼容性

- GraalVM 原生镜像： 由于反射和类加载等动态功能的限制，并非所有 Java 库和框架都与 GraalVM 的原生镜像完全兼容。开发人员可能需要配置其应用程序以使用 GraalVM。
- JVM：  JVM 支持所有 Java 库和框架，没有兼容性问题，使其成为复杂应用程序的更安全的选择。

### 生态系统和工具

- GraalVM 原生镜像：  GraalVM 仍在不断发展，其生态系统不如 JVM 成熟。但是，它提供了多语言编程和原生镜像生成等独特功能。
- JVM：  JVM 拥有成熟的生态系统，包括丰富的工具、库和框架，使其成为企业应用程序的首选。


## GraalVM 和 JVM 的用例


### 何时使用GraalVM原生镜像：

- 无服务器功能： 快速的启动时间和低内存使用率使 GraalVM 成为 AWS Lambda 或 Google Cloud Functions 等无服务器平台的理想选择。
- 命令行工具： 本机可执行文件非常适合需要快速启动和高效运行的 CLI 工具。
- 微服务：  GraalVM 的轻量级特性非常适合微服务架构，尤其是在 Kubernetes 等容器化环境中。
- 边缘计算： 在资源有限的边缘设备上运行的应用程序可以受益于 GraalVM 的低内存占用。


### 何时使用 JVM：

- 企业应用程序：  Web 服务器、ERP 系统和数据库等长期运行的应用程序受益于 JVM 的 JIT 优化和成熟的生态系统。
- 大数据处理：  Apache Spark 和 Hadoop 等框架针对 JVM 进行了优化，使其成为大数据工作负载的首选。
- 遗留系统： 依赖于反射或类加载等动态功能的现有 Java 应用程序更适合 JVM。
- 高性能计算： 需要持续性能的应用程序（例如金融交易系统）可受益于 JVM 的 JIT 编译器。

## GraalVM 是 Java 应用程序的未来吗？

GraalVM 代表了 Java 演进的重要一步，特别是对于云原生和资源受限的环境。其原生映像功能解决了 JVM 的一些限制，例如启动时间慢和内存使用率高。但是，对于需要动态优化并与 Java 生态系统完全兼容的长期运行的复杂应用程序，JVM 仍然是更好的选择。

### GraalVM 面临的挑战

虽然 GraalVM 提供了令人兴奋的可能性，但它也并非没有挑战。某些库和框架的兼容性问题可能会使迁移变得困难。此外，本机映像生成过程可能很耗时，并且需要仔细配置。

### GraalVM与JVM的共存

GraalVM 不会取代 JVM，而是可能会与 JVM 共存，服务于不同的用例。开发人员可以选择适合自己工作的工具，在启动时间和内存效率至关重要的场景中利用 GraalVM，而在传统的长时间运行的应用程序中则依赖 JVM。

## 小结

总的来说，GraalVM 是一项具有巨大潜力的新兴技术，它为 Java 带来了全新的性能优化和跨语言协作磨合的可能性。对于那些追求启动速度和内存优化的现代应用来说，GraalVM 无​​疑是一个值得关注的选择。不过，作为一种相对年轻的技术，GraalVM 还需要在兼容性、稳定性等方面进行进一步的打磨，才能真正成为 Java 生态系统中不可忽视的重要部分。

对于开发者来说，GraalVM 提供了一个全新的选择，不断变化的技术需求，我们是否愿意拥抱它，取决于我们的需求和技术栈的实际情况。而随着技术的不断发展，未来 GraalVM 是否会完全替代传统 JVM，也许只是时间问题。